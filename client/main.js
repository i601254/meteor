import { Template } from 'meteor/templating';
import { ReactiveVar } from 'meteor/reactive-var';
import { zoneMaps } from '../lib/collections.js';
import { Zones } from '../imports/api/locations.js';
import './main.html';

Meteor.call("getSessionId", function(err, id) {
  sessId = id;
});

Template.body.helpers({
  locations() {
    return Locations.find({});
  },
});

// Submit button pressed
Template.getAddressForm.events({
  'submit form': function(event){
    event.preventDefault();
   // var installAddress = event.target.installAddress.value;
 
    Meteor.call('plotMap', zoneId, function(error, result){
       if (error) {
         console.log(error);
       }else{
          console.log(result);
       }
    });
  }
});

// Meteor.subscribe('zonemap');
/*
geojsonFeature = {
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": {
                "name": "TK1277"
            },
            "geometry": {
                "type": "LineString",
                "coordinates": [
                  [-77.463548,39.708634],[-77.484943,39.705874],[-77.48608,39.704211],[-77.485567,39.698084],[-77.486079,39.697206],[-77.48659,39.695326],[-77.486931,39.69432],[-77.490629,39.689984],[-77.492938,39.688272],[-77.49343,39.685369],[-77.495726,39.681452],[-77.49256,39.676996],[-77.496343,39.672452],[-77.497364,39.668065],[-77.503926,39.664905],[-77.504444,39.663685],[-77.504745,39.661623],[-77.508722,39.658484],[-77.511565,39.655156],[-77.512929,39.652441],[-77.513042,39.650079],[-77.51594,39.647135],[-77.520941,39.639475],[-77.523101,39.636847],[-77.522077,39.636453],[-77.520259,39.63755],[-77.515939,39.638424],[-77.512926,39.637988],[-77.507242,39.636588],[-77.504286,39.636239],[-77.500135,39.636544],[-77.493088,39.635139],[-77.489565,39.635095],[-77.489818,39.621193],[-77.489817,39.620014],[-77.488907,39.618743],[-77.486975,39.617607],[-77.486192,39.615115],[-77.486419,39.613538],[-77.501988,39.611043],[-77.508202,39.61124],[-77.512462,39.610585],[-77.51644,39.610058],[-77.51996,39.605816],[-77.522347,39.604149],[-77.524961,39.601696],[-77.526105,39.597395],[-77.531724,39.585881],[-77.544908,39.587281],[-77.546157,39.586628],[-77.548542,39.583519],[-77.549507,39.582075],[-77.555752,39.578002],[-77.558459,39.578416],[-77.562208,39.581304],[-77.565559,39.581436],[-77.567604,39.58218],[-77.568171,39.583581],[-77.569137,39.584327],[-77.571465,39.584634],[-77.580897,39.590804],[-77.583053,39.586513],[-77.585438,39.583403],[-77.584471,39.581084],[-77.584949,39.578202],[-77.586538,39.573122],[-77.586368,39.571807],[-77.587958,39.569969],[-77.589376,39.567343],[-77.591137,39.565373],[-77.593686,39.564139],[-77.594652,39.563133],[-77.594537,39.562301],[-77.593742,39.56099],[-77.594423,39.55858],[-77.594026,39.556785],[-77.594422,39.553591],[-77.595509,39.551021],[-77.596986,39.550235],[-77.598405,39.550365],[-77.5992,39.550364],[-77.599028,39.549007],[-77.597893,39.547345],[-77.597837,39.544585],[-77.5967,39.542574],[-77.597467,39.540584],[-77.601385,39.53962],[-77.603087,39.538614],[-77.604505,39.537213],[-77.607343,39.535241],[-77.608818,39.533362],[-77.609499,39.532048],[-77.610577,39.530383],[-77.613016,39.529509],[-77.612847,39.527625],[-77.614353,39.525936],[-77.613898,39.523923],[-77.614068,39.522303],[-77.617706,39.518052],[-77.619675,39.51316],[-77.619534,39.511638],[-77.622208,39.507615],[-77.620517,39.505657],[-77.621079,39.503377],[-77.623189,39.500333],[-77.61431,39.49142],[-77.618391,39.48566],[-77.621347,39.483486],[-77.62191,39.480875],[-77.6205,39.476964],[-77.617682,39.474682],[-77.616046,39.468353],[-77.618361,39.466473],[-77.621043,39.465154],[-77.621895,39.463554],[-77.621649,39.459977],[-77.622381,39.459036],[-77.626281,39.457528],[-77.627984,39.452635],[-77.626519,39.448119],[-77.630297,39.448399],[-77.634438,39.445951],[-77.635288,39.441528],[-77.638088,39.435502],[-77.637727,39.431284],[-77.638091,39.427987],[-77.637602,39.426012],[-77.638451,39.421121],[-77.638926,39.418674],[-77.640507,39.415757],[-77.640261,39.409451],[-77.639285,39.407003],[-77.641837,39.398346],[-77.652924,39.370564],[-77.642031,39.366497],[-77.635136,39.36799],[-77.599139,39.35581],[-77.588453,39.353717],[-77.56926,39.33343],[-77.566592,39.320918],[-77.569751,39.311667],[-77.568185,39.30653],[-77.566381,39.305949],[-77.564726,39.3049],[-77.562921,39.303389],[-77.561643,39.301296],[-77.561567,39.299839],[-77.562243,39.298674],[-77.562394,39.296988],[-77.562883,39.294101],[-77.561604,39.292937],[-77.561904,39.291018],[-77.561678,39.288864],[-77.561603,39.287818],[-77.560625,39.286013],[-77.531155,39.286711],[-77.498866,39.304481],[-77.495331,39.305589],[-77.48736,39.308846],[-77.487867,39.320893],[-77.45659,39.325907],[-77.4229,39.330538],[-77.403191,39.32978],[-77.382453,39.328918],[-77.388862,39.313246],[-77.391494,39.311034],[-77.402773,39.307713],[-77.391477,39.299777],[-77.359294,39.283721],[-77.347492,39.28593],[-77.326029,39.28086],[-77.317624,39.28483],[-77.308063,39.289083],[-77.30718,39.294079],[-77.30302,39.306682],[-77.299174,39.308803],[-77.288021,39.314486],[-77.27913,39.302456],[-77.232798,39.324445],[-77.216557,39.332054],[-77.182142,39.318045],[-77.166031,39.309158],[-77.151993,39.300101],[-77.160967,39.289613],[-77.147017,39.275136],[-77.134046,39.270692],[-77.114574,39.264831],[-77.097352,39.264342],[-77.079918,39.258992],[-77.071942,39.268617],[-77.024443,39.294798],[-77.031408,39.315708],[-77.02825,39.319983],[-77.023571,39.325754],[-77.013766,39.337703],[-77.017977,39.348628],[-77.015432,39.353512],[-77.010295,39.354618],[-77.010199,39.360253],[-77.01852,39.38841],[-77.052927,39.407968],[-77.04875,39.419775],[-77.052552,39.434371],[-77.066337,39.439898],[-77.071784,39.440035],[-77.087641,39.458154],[-77.090487,39.47569],[-77.090782,39.486199],[-77.073532,39.493467],[-77.042579,39.511367],[-77.043962,39.520263],[-77.034532,39.529816],[-77.033922,39.541669],[-77.038793,39.542658],[-77.039273,39.545181],[-77.045184,39.550232],[-77.045702,39.553465],[-77.056208,39.553928],[-77.066051,39.566611],[-77.092477,39.568478],[-77.118621,39.592692],[-77.104626,39.622976],[-77.107172,39.628598],[-77.110068,39.644446],[-77.108657,39.651269],[-77.10577,39.665018],[-77.103207,39.667631],[-77.092224,39.668478],[-77.090062,39.677288],[-77.084009,39.68707],[-77.072041,39.698957],[-77.066235,39.712182],[-77.067963,39.720151],[-77.470595,39.719982],[-77.468091,39.718757],[-77.465473,39.71775],[-77.463026,39.715343],[-77.462856,39.713766],[-77.463368,39.710704],[-77.463548,39.708634]
                ]
            }
        },
        {
          "type":"Feature",
          "properties":{
            "name":"TK1277",
            "desc":null
            },
          "geometry":{
            "type":"MultiLineString",
            "coordinates": [
              [
               [-94.236841,43.499938],[-94.292623,43.500146],[-94.316811,43.500072],[-94.406867,43.500348],[-94.404359,43.48825],[-94.384768,43.487724],[-94.383933,43.473738],[-94.364502,43.459828],[-94.344847,43.444576],[-94.3841,43.44393],[-94.403676,43.431],[-94.423145,43.430766],[-94.403527,43.413936],[-94.402241,43.400657],[-94.423202,43.399739],[-94.402494,43.398455],[-94.403057,43.38524],[-94.382836,43.37033],[-94.364556,43.356157],[-94.384319,43.327452],[-94.403859,43.326766],[-94.423382,43.327191],[-94.442714,43.327566],[-94.442428,43.298486],[-94.442935,43.281155],[-94.443861,43.241729],[-94.463061,43.240966],[-94.463557,43.226896],[-94.482649,43.226287],[-94.502365,43.226504],[-94.502455,43.212367],[-94.481912,43.197812],[-94.482841,43.183145],[-94.462116,43.168679],[-94.464295,43.155375],[-94.442981,43.155432],[-94.444747,43.141216],[-94.443406,43.126094],[-94.482276,43.11253],[-94.481433,43.098719],[-94.50152,43.097651],[-94.481956,43.082681],[-94.50197,43.077505],[-94.502426,43.067236],[-94.520763,43.053035],[-94.489931,43.051291],[-94.481772,43.037835],[-94.481023,43.023349],[-94.442361,43.009505],[-94.41202,43.012233],[-94.383916,43.009072],[-94.393432,42.995008],[-94.383928,42.980037],[-94.363867,42.98054],[-94.343714,42.980459],[-94.324872,42.972428],[-94.314622,42.973397],[-94.30576,42.973091],[-94.29623,42.972177],[-94.287202,42.97291],[-94.266714,42.983366],[-94.228751,42.992887],[-94.227824,43.009157],[-94.213015,43.013128],[-94.195636,43.023805],[-94.165264,43.024168],[-94.126859,43.024212],[-94.087937,43.02403],[-94.080809,43.029584],[-94.069217,43.038086],[-94.0688,43.052154],[-94.088593,43.051948],[-94.088348,43.066325],[-94.087908,43.082114],[-94.092935,43.087681],[-94.08899,43.097022],[-94.049036,43.084054],[-94.028895,43.085963],[-94.010282,43.066754],[-94.029663,43.052075],[-94.010577,43.037699],[-93.99099,43.051586],[-93.970063,43.051578],[-93.949882,43.051997],[-93.949709,43.066556],[-93.95096,43.082092],[-93.98934,43.08101],[-93.984065,43.083522],[-93.969323,43.090921],[-93.949723,43.090549],[-93.930472,43.087675],[-93.911542,43.089629],[-93.891004,43.082353],[-93.891729,43.037723],[-93.871503,43.037904],[-93.85001,43.03899],[-93.871316,43.023622],[-93.851819,43.023845],[-93.832887,43.009565],[-93.808795,43.009037],[-93.792665,43.009112],[-93.7654,43.00937],[-93.753287,43.009453],[-93.733613,43.010423],[-93.711577,42.997031],[-93.701199,42.995514],[-93.675601,42.995382],[-93.655643,42.981173],[-93.616369,42.995014],[-93.596734,42.981026],[-93.587225,42.981325],[-93.556932,42.992427],[-93.537155,42.981212],[-93.496834,42.995184],[-93.496939,43.017979],[-93.498179,43.023045],[-93.497484,43.053181],[-93.496795,43.066744],[-93.49815,43.067932],[-93.498115,43.083324],[-93.495815,43.083445],[-93.49745,43.110503],[-93.517498,43.111944],[-93.517993,43.123224],[-93.496477,43.140827],[-93.497162,43.155323],[-93.497652,43.169002],[-93.517087,43.169503],[-93.49701,43.183902],[-93.496592,43.198298],[-93.517248,43.198062],[-93.546628,43.19824],[-93.544066,43.207915],[-93.529332,43.207441],[-93.524886,43.204323],[-93.517315,43.205583],[-93.51921,43.211583],[-93.517317,43.212845],[-93.497099,43.206819],[-93.496607,43.213158],[-93.477914,43.242223],[-93.496795,43.255429],[-93.496264,43.270368],[-93.498225,43.284616],[-93.497401,43.291831],[-93.516802,43.320757],[-93.523291,43.322012],[-93.537592,43.306559],[-93.557144,43.32788],[-93.576306,43.342464],[-93.576381,43.357483],[-93.612094,43.357261],[-93.613457,43.359408],[-93.59742,43.371433],[-93.597385,43.384003],[-93.597221,43.41635],[-93.617016,43.41504],[-93.636925,43.429963],[-93.617559,43.451294],[-93.622332,43.459692],[-93.598824,43.462068],[-93.581483,43.459066],[-93.577055,43.468436],[-93.616243,43.473539],[-93.575675,43.474544],[-93.57698,43.488084],[-93.578706,43.499582],[-93.608145,43.499587],[-93.652525,43.499304],[-93.722398,43.499424],[-94.001455,43.499866],[-94.101637,43.500136],[-94.135763,43.499873],[-94.168015,43.499876],[-94.204028,43.499923],[-94.236841,43.499938]
              ]
            ]
          }
        }
    ]
};
*/

Meteor.subscribe('zonemap');

Template.zoneMaps.items = function() {
  return zoneMaps();
};


Template.map.rendered = function() {
  L.Icon.Default.imagePath = 'packages/bevanhunt_leaflet/images';
 
  var map = L.map('map', {
  doubleClickZoom: false
}).setView([40.1668141, -76.8388169], 10);

  var mileTometer = 1609.34;    // Used for radius of circles to convert meters to miles
  
//  L.geoJson(geojsonFeature).addTo(map);
  
  var redMarker = L.AwesomeMarkers.icon({
    icon: 'flag',
    prefix: 'ion',
    markerColor: 'red'
  });

  var blueMarker = L.AwesomeMarkers.icon({
    markerColor: 'orange'
  });

/// Geojson functions with Leaflet

function onEachFeature(feature, layer){
  if (feature.properties && feature.properties.popupContent) {
    layer.bindPopup(feature.properties.popupContent);
  }
}

//  var geojsonFeature = {
//    "type": "Feature",
//    "properties": {
//      "name": "Coors Field",
//      "amenity": "Baseball Stadium",
//      "popupContent": "This is where the Rockies play!"
//  },
//  "geometry": {
//    "type": "Point",
//    "coordinates": [-104.99404, 39.75621]
//   }
//  };
                  
//  L.geoJson(geojsonFeature, {
//    onEachFeature: onEachFeature
//  }).addTo(map);

/// End of Geojson and Leaflet

/** Add Map Tiles from Mapbox  **/
  L.tileLayer('https://api.tiles.mapbox.com/v4/{mapID}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org"/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
    mapID: 'i601254.15mj5o41',
    accessToken: 'pk.eyJ1IjoiaTYwMTI1NCIsImEiOiJjaXMyN2FvN3AwMDJmMnpsa3d6dGh4MXZqIn0.3ZFXal84sFTUTOziIXO9NA'
  }).addTo(map);
/** End of Map Tiles **/

  L.marker([40.1668141, -76.8388169], {icon: redMarker} ).addTo(map);	// Installation location also used as center point of map

// Draw circle around center point with 5 mile radius
  L.circle([40.1668141, -76.8388169], (5*mileTometer), {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.2
  }).addTo(map);

// Draw circle around center point with 10 mile radius
  L.circle([40.1668141, -76.8388169], (10*mileTometer), {
    color: 'blue',
    fillColor: '',
    fillOpacity: 0.0
  }).addTo(map);

// Draw circle around center point with 20 mile radiu
  L.circle([40.1668141, -76.8388169], (20*mileTometer), {
    color: 'orange',
    fillColor: '',
    fillOpacity: 0.0
  }).addTo(map);


// Markers for random locations to simulate service requests
//  var markers = [
//    [40.152240, -76.966627, "Location 1"],
//    [40.227363, -76.894572, "Location 2"],
//    [40.262295, -76.825336, "Location 3"],
//    [40.107615, -76.859768, "Location 4"]
//  ];

//  for (var i=0; i<markers.length; i++) {
           
//            var lat = markers[i][0];
//            var lon = markers[i][1];
//            var popupText = markers[i][2];
//
//            var markerLocation = new L.LatLng(lat, lon);
//            var marker = new L.marker(markerLocation);
//            map.addLayer(marker);

//            marker.bindPopup(popupText);
//  }
};

